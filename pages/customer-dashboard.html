<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta name="mobile-web-app-capable" content="yes">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#ffd600">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>حلاقي - الصفحة الرئيسية</title>
    <link rel="stylesheet" href="../css/customer.css">
    <style>
        body {
            background: #181818 !important;
            color: #fff !important;
        }
        .app-header {
            background: #ffd600 !important;
            color: #222 !important;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        .header-content h1 {
            color: #222 !important;
        }
        .dashboard-card, .posts-container, .profile-details, .rewards-progress {
            background: #232323 !important;
            color: #fff !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.18) !important;
        }
        .dashboard-card h4, .dashboard-card .card-main, .progress-circle, .profile-image {
            color: #ffd600 !important;
            border-color: #ffd600 !important;
        }
        .nav-item.active, .floating-book-btn, .btn-logout {
            background: #ffd600 !important;
            color: #222 !important;
        }
        .nav-item, .nav-item i, .nav-item span {
            color: #fff !important;
        }
        .bottom-nav {
            background: #232323 !important;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
        .floating-book-btn {
            box-shadow: 0 4px 18px rgba(255,214,0,0.18) !important;
        }
        .badge {
            background: #ffd600 !important;
            color: #222 !important;
        }
        .profile-header h2, .profile-header p, .detail-item span {
            color: #fff !important;
        }
        .progress-circle {
            border: 3px solid #ffd600 !important;
        }
        .btn-logout:hover {
            background: #ffe066 !important;
            color: #222 !important;
        }
        .user-info h2 span { color:#ffd600; }
        .ad-action-btn { cursor:pointer; }
        .bottom-nav .nav-item { position:relative; }
        #notificationsBadge { position:absolute; top:4px; right:18px; min-width:20px; height:20px; padding:0 6px; display:none; border-radius:12px; font-size:0.7rem; line-height:20px; font-weight:600; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- الهيدر -->
    <header class="app-header">
        <div class="header-content">
            <h1>حلاقي</h1>
        </div>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="main-content" id="mainContent">
        <!-- صفحة الرئيسية -->
        <div class="page active" id="homePage">
            <div class="user-info">
                <h2>مرحباً، <span id="userName">زائر</span></h2>
                <p>نقاطك: <span id="userPoints">0</span></p>
            </div>

        <!-- منطقة الإعلانات التفاعلية -->
        <div class="ads-section" id="adsSection">
            <!-- مثال إعلان من الحلاق -->
            <div class="ad-card ad-barber">
                <div class="ad-content">
                    <h3>عرض خاص من الحلاق!</h3>
                    <p>احجز الآن واحصل على خصم 20% على الحلاقة التالية.</p>
                </div>
                <button class="ad-action-btn" onclick="alert('تم حجز العرض!')">احجز العرض</button>
            </div>
            <!-- مثال إعلان من النظام -->
            <div class="ad-card ad-system">
                <div class="ad-content">
                    <h3>جديد في التطبيق</h3>
                    <p>يمكنك الآن مشاركة رأيك حول تجربتك مع الحلاق.</p>
                </div>
                <button class="ad-action-btn" onclick="alert('تم فتح صفحة التقييم!')">قيّم تجربتك</button>
            </div>
        </div>

            <!-- منطقة المنشورات -->
            <div class="posts-container" id="postsContainer">
                <div class="loading-posts">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>جاري تحميل المنشورات...</p>
                </div>
                <!-- سيتم توليد المنشورات ديناميكياً من js، مثال على منشور مع وسائط: -->
                <!--
                <div class="post-card">
                    <div class="post-header">
                        <img src="../images/default-avatar.jpg" class="post-avatar" alt="الحلاق">
                        <span class="post-barber-name">اسم الحلاق</span>
                    </div>
                    <div class="post-content">نص المنشور هنا...</div>
                    <div class="post-media">
                        <img src="media-url.jpg" alt="صورة مرفقة" class="post-media-img" />
                        <video src="media-url.mp4" controls class="post-media-video"></video>
                    </div>
                    <div class="post-date">قبل دقيقة</div>
                </div>
                -->
            </div>
    <style>
        .post-card {
            background: #232323;
            border-radius: 10px;
            margin-bottom: 18px;
            padding: 14px 12px 10px 12px;
            box-shadow: 0 1px 6px rgba(0,0,0,0.10);
        }
        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
        }
        .post-avatar {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            border: 2px solid #ffd600;
        }
        .post-barber-name {
            color: #ffd600;
            font-weight: 600;
        }
        .post-content {
            margin-bottom: 8px;
            color: #fff;
            font-size: 1.05em;
        }
        .post-media {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }
        .post-media-img {
            max-width: 120px;
            max-height: 120px;
            border-radius: 8px;
            object-fit: cover;
            background: #111;
        }
        .post-media-video {
            max-width: 160px;
            max-height: 120px;
            border-radius: 8px;
            background: #111;
        }
        .post-date {
            color: #aaa;
            font-size: 0.92em;
            text-align: left;
        }
        /* تعديل حجم صورة صاحب المنشور */
        .barber-avatar, .post-avatar { /* توحيد الاسمين في حال استخدام أحدهما */
            width: 42px !important;
            height: 42px !important;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ffd600;
            flex-shrink: 0;
        }
        /* ضمان ظهور صورة المنشور الأساسية */
        .post-image { 
            max-width: 100%;
            border-radius: 10px;
            display: block;
            margin-bottom: 8px;
            background:#111;
            object-fit: cover;
        }
        /* حاوية وسائط متعددة (صور/فيديو) */
        .post-media { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:8px; }
        .post-media img { width:120px; height:120px; object-fit:cover; border-radius:8px; background:#111; }
        .post-media video { width:170px; max-width:100%; height:120px; object-fit:cover; border-radius:8px; background:#111; }
        /* إزالة التعميم الذي كان يؤثر على صورة الأفاتار */
        /* تم حذف القاعدة العامة .posts-container img لتجنب تكبير الأفاتار */
        /* ضبط صورة صاحب المنشور (الأفاتار) وعدم تأثرها بأي قواعد لاحقة */
        .posts-container .post-header .barber-avatar { width:44px !important; height:44px !important; object-fit:cover; border-radius:50%; border:2px solid #ffd600; flex-shrink:0; }
        /* حصر القواعد التالية على وسائط المحتوى فقط */
        .posts-container .post-media img.post-media-img { width:120px; height:120px; object-fit:cover; border-radius:8px; background:#111; }
        .posts-container .post-media video.post-media-video { width:170px; max-width:100%; height:120px; object-fit:cover; border-radius:8px; background:#111; }
        /* في حال وجود صورة قديمة مفردة للحقل image فقط */
        .posts-container img.post-image { max-width:100%; height:auto; border-radius:10px; display:block; }
    </style>
        </div>

        <!-- صفحة الإشعارات -->
        <div class="page" id="notificationsPage">
            <h2>الإشعارات</h2>
            <div class="notifications-list">
                <!-- سيتم إضافة الإشعارات هنا -->
            </div>
        </div>

        <!-- صفحة الخصومات والهدايا -->
        <div class="page" id="rewardsPage">
            <h2>الخصومات والهدايا</h2>
            <div class="rewards-progress">
                <div class="progress-circle">
                    <span id="visitsCount">0</span>/5
                    <p>زيارات</p>
                </div>
                <div class="reward-info">
                    <h3>الهدية القادمة</h3>
                    <p>خصم 50% + هدية من اختيارك</p>
                </div>
            </div>
            <div class="available-gifts">
                <h3>الهدايا المتاحة</h3>
                <!-- سيتم إضافة الهدايا هنا -->
            </div>
        </div>

        <!-- صفحة الملف الشخصي -->
        <div class="page" id="profilePage">
            <div class="profile-header">
                <div class="profile-image">
                    <img src="../images/default-avatar.jpg" alt="صورة الملف الشخصي" id="profileImage">
                </div>
                <h2 id="profileName">اسم المستخدم</h2>
                <p id="profilePhone">رقم الهاتف</p>
            </div>
            <div class="profile-details">
                <div class="detail-item">
                    <i class="fas fa-scissors"></i>
                    <span>آخر حلاقة: <span id="lastHaircut">-</span></span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-star"></i>
                    <span>النقاط المجمعة: <span id="totalPoints">0</span></span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-history"></i>
                    <span>عدد الزيارات: <span id="visitCount">0</span></span>
                </div>
            </div>
            <button class="btn-logout">تسجيل الخروج</button>
        </div>
    </main>

    <!-- زر الحجز العائم -->
    <button class="floating-book-btn" id="bookAppointment">
        <i class="fas fa-calendar-plus"></i>
        <span>حجز موعد</span>
    </button>

    <!-- شريط التنقل السفلي -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-page="homePage">
            <i class="fas fa-home"></i>
            <span>الرئيسية</span>
        </button>
        <button class="nav-item" data-page="notificationsPage">
            <i class="fas fa-bell"></i>
            <span>الإشعارات</span>
            <span class="badge" id="notificationsBadge">0</span>
        </button>
        <div class="nav-item-spacer"></div>
        <button class="nav-item" data-page="rewardsPage">
            <i class="fas fa-gift"></i>
            <span>الخصومات</span>
        </button>
        <button class="nav-item" data-page="profilePage">
            <i class="fas fa-user"></i>
            <span>حسابي</span>
        </button>
    </nav>

    <script>
        localStorage.setItem('debugMode', 'true');
        // تسجيل الـ Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('../service-worker.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        // توجيه زر الحجز العائم إلى صفحة الحجز
        document.addEventListener('DOMContentLoaded', function() {
            var bookBtn = document.getElementById('bookAppointment');
            if(bookBtn){
                bookBtn.onclick = function(){
                    window.location.href = '../pages/booking.html';
                };
            }
        });
    </script>
    <script type="module" src="../js/customer-dashboard.js"></script>
</body>
</html>
